<!DOCTYPE html>
<html>
<style>
	.center-content{
		align-content : center;
		text-align : center;
	}
</style>
<% include ./partials/header %>

	<body>
	<div class="row">
 	<div class="col-sm-6">
 	<h3>Add New Tool : </h3>
 	<hr>
 	<form method="POST">
				<span>
				<br><br>
				<input type="text" id="name-auto" class="form-control" name="name" placeholder="Tool Name"><br>
				<input type="text" class="form-control" id="inputWeight" name="weightage" placeholder="Weightage"><br>
				<input type="text" class="form-control" name="targetStudent" placeholder="Target students"><br>
				<input type="text" class="form-control" name="totalMark" placeholder="Total Marks"><br>
				<input type="text" class="form-control" name="targetMark" placeholder="Target Marks"><br>
				<input type="text" class="form-control" name="high" placeholder="high"><br>
				<input type="text" class="form-control" name="mid" placeholder="mid"><br>
				<input type="text" class="form-control" name="low" placeholder="low"><br>
				<select id="tool-dropdown" name="toolType" class="to-dropdown custom-select">
				<option value="Direct" >Direct</option>
				<option value="Indirect" >Indirect</option>
				<br>
				</select><br><br>
				<button id="formSubmit" data-toggle="tooltip" title="Please Enter Valid Weightage" class="btn btn-outline-success btn-lg btn-block">Submit </button>
			</span>
		</form>
	</div>

 	<div class="col-sm-6">
 	<span>
 	<h3>           My Tools : </h3>
 	<hr>
 	<table border="0" cellspacing="40" cellpadding="20">
		<% for (t in thisToolNames ){ %>

		<tr>
		<td class="<%= t %>"><button class="btn btn-outline-dark btn-lg btn-block"> <%= thisToolNames[t] %> </button>
		</td>
		<td>
		<form action="tool/<%= tools[t]._id %>/delete" method="POST">
			<button class="btn btn-outline-danger btn-lg">Delete</button>
		</form>
		</td>
		<td>
			<span data-toggle="modal" class="btn btn-block" data-target="#myForm"><button type="submit"
				data-toolIndex="<%=t%>"
				class="tool-editor btn btn-outline-warning">Edit Tool</button></span>
		</td>
		</tr>

	    <% } %>
	</table>
	<h5> <span data-toggle="modal" class="btn btn-block" data-target="#myMod">View Detailed Info</span> </h5>
	</span>


	<div class="modal fade" id="myForm">
	  <div class="modal-dialog">
	    <div class="modal-content">

	      <!-- Modal Header -->
	      <div class="modal-header" align='center'>
	          <h4 class="modal-title">     Edit Tool Outcome      </h4>
	          <button type="button" class="close" data-dismiss="modal">&times;</button>
	      </div>

	      <!-- Modal body -->
	      <div class="modal-body">

	            <form action="" class="edit-form" method="post">
	                <div class="form-group" align='center'>

	          			<input type="text" id="eweightage" name="weightage" placeholder="" value=""><br><br>
	          			<input type="text" id="etargetStudent" name="targetStudent" placeholder="Course no" value=""><br><br>
	          			<input type="text" id="etotalMark" name="totalMark" placeholder="blooms level" value=""><br><br>
									<input type="text" id="etotalStud" name="totalStud" placeholder="Course no" value=""><br><br>
									<input type="text" id="etargetMark" name="targetMark" placeholder="Course no" value=""><br><br>
									<input type="text" id="estudentsAchieved" name="studentsAchieved" placeholder="Course no" value=""><br><br>
									<input type="text" id="etoolType" name="toolType" placeholder="Course no" value=""><br><br>
									<input type="text" id="ehigh" name="high" placeholder="Course no" value=""><br><br>
									<input type="text" id="emid" name="mid" placeholder="Course no" value=""><br><br>
									<input type="text" id="elow" name="low" placeholder="Course no" value=""><br><br>

	          			<button type="submit" class="btn btn-primary btn-lg">Submit</button>
	              </div>
	            </form>
	      </div>

	    </div>
	  </div>
	</div>






	<!-- The Modal -->
	<div class="modal fade" id="myMod">
		<div class="modal-dialog">
			<div class="modal-content">

				<!-- Modal Header -->
				<div class="modal-header">
				    <h4 class="modal-title">My Tool </h4>
				    <button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>

				<!-- Modal body -->
				<div class="modal-body">
					<% for(tool in tools) { %>
			        <table class="table">
								<tbody>

								<tr>
								<td>Name : </td>
								<td id="weightage">
									<td><%= thisToolNames[tool] %></td>
								</td>
							</tr>
			        		<tr>
				              <td>Weightage : </td>
				              <td id="weightage">
				              	<td class="weight" data-type="<%= tools[tool].toolType %>" id="<%= tools[tool].weightage %>"><%= tools[tool].weightage %></td>
				              </td>

				            </tr>
				            <tr>
							  <td>Target No. Of Student : </td>
				              <td id="targetStudent">
				              </td>
				              <td>
				              	<%= tools[tool].targetStudent %>
				                <!--  -->
				              </td>
				              <tr>
								<td>Total marks : </td>
				                <td id="totalMark"> </td>
				                <td>
				                	<%= tools[tool].totalMark %>
				                  <!--  -->
				                </td>
				              </tr>
				              <tr>
								<td>Total No. Of Students : </td>
				                <td id="totalStud"> </td>
				                <td>
				                	<%= tools[tool].totalStud %>
				                  <!--  -->
				                </td>
				              </tr>
				              <tr>
								<td>No. Of Students Achieved Target : </td>
				                <td id="studentsAchieved"> </td>
				                <td>
				                	<%= tools[tool].studentsAchieved %>
				                  <!--  -->
				                </td>
				              </tr>
				              <tr>
								<td>Type of Tool : </td>
				                <td id="toolType"> </td>
				                <td>
				                  <!--  -->
				                  <%= tools[tool].toolType %>
				                </td>
				              </tr>
				              <tr>
								<td>High : </td>
				                <td id="high"> </td>
				                <td>
				                  <!--  -->
				                  <%= tools[tool].high %>
				                </td>
				              </tr>
				              <tr>
								<td>Mid : </td>
				                <td id="mid"> </td>
				                <td>
				                  <!--  -->
				                  <%= tools[tool].mid %>
				                </td>
				              </tr>
				              <tr>
								<td>Low : </td>
				                <td id="low"> </td>
				                <td>
				                	<%= tools[tool].low %>
				                  <!--  -->
				                </td>
				              </tr>
				              <tr>
								<td>Point : </td>
				                <td id="point">
				                <%= tools[tool].point %>
				                  <!--  -->
				                </td>
										</tr>
									<hr>
				        </tbody>
					</table>
				<% } %>
				</div>

			</div>
		</div>
	</div>

 			</div>




			 <script>
			 	url = "/api/tools";
			 	$.get(url , function(data , status){
					 console.log(data , "hello data");

					$( "#name-auto" ).autocomplete({
						source: data
					});
				 });



				 var totDW = 0 , totIDW = 0;
				 $('.weight').each(function(item){
					 if($(this).attr('data-type') == "Direct"){
						totDW+= parseFloat($(this).attr('id'));
					 }
					 else{
						totIDW+= parseFloat($(this).attr('id'));
					 }
				 });

				 weightChecker = function (){
					console.log(" weichkr called")
					 var inp = parseFloat(Number($('#inputWeight').val()).toPrecision(2))
					 totDW = parseFloat(totDW.toPrecision(2))
					 var toolT = $("#tool-dropdown option:selected ").val();
					 console.log(toolT , " ", inp , " " , totDW , " " , totIDW)
					 if (toolT == "Direct" && inp + totDW > 1){
						 return true;
					 }
					 else if( toolT == "Indirect" && inp + totIDW > 1 ){
						 return true;
					 }
					 else{
						return false;
					 }
				 }

				 $('#inputWeight').keyup(function(){
					if( weightChecker() ){
						$('#formSubmit').prop('disabled', 'true');
						$('#formSubmit').tooltip('enable')
					}
					else{
						$('#formSubmit').removeAttr('disabled');
						$('#formSubmit').tooltip('disable')
					}
					}
				 );
				 $('.to-dropdown').click(function(){
					if( weightChecker() ){
						$('#formSubmit').tooltip('enable')
						$('#formSubmit').prop('disabled', 'true');
						$('#formSubmit').tooltip('disable')
					}
					else{
						$('#formSubmit').removeAttr('disabled');
					}
					}
				 );



			 </script>


			<% include ./partials/footer %>
				</body>

</html>
